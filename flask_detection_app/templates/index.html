<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Disease Detection</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .card {
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: none;
        }
        
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s;
            background: #f8f9fa;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: #764ba2;
            background: #e9ecef;
        }
        
        .upload-area.dragover {
            border-color: #28a745;
            background: #d4edda;
        }
        
        .preview-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .result-badge {
            font-size: 1.1rem;
            padding: 10px 20px;
            border-radius: 25px;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        
        .symptom-item {
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #667eea;
        }
        
        .treatment-section {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid #ffc107;
            margin-bottom: 15px;
        }
        
        .prevention-item {
            background: #d1ecf1;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #0dcaf0;
        }
        
        .confidence-high { color: #28a745; }
        .confidence-medium { color: #ffc107; }
        .confidence-low { color: #dc3545; }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <div class="text-center text-white mb-4">
            <h1 class="display-4 fw-bold">ðŸŒ¿ Plant Disease Detection</h1>
            <p class="lead">Upload an image to detect plant diseases instantly</p>
        </div>

        <div class="row g-4">
            <!-- Upload Section -->
            <div class="col-lg-5">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title mb-4">
                            <i class="bi bi-cloud-upload"></i> Upload Image
                        </h5>
                        
                        <div class="upload-area" id="uploadArea">
                            <i class="bi bi-image display-1 text-muted"></i>
                            <p class="mt-3 mb-2">Drag & drop an image here or click to browse</p>
                            <small class="text-muted">Supports: JPG, PNG (Max 50MB)</small>
                            <input type="file" id="fileInput" accept="image/*" style="display: none;">
                        </div>
                        
                        <div id="previewContainer" class="text-center" style="display: none;">
                            <img id="previewImage" class="preview-image" alt="Preview">
                            <div class="mt-3">
                                <button class="btn btn-primary btn-lg" id="detectBtn">
                                    <i class="bi bi-search"></i> Run Detection
                                </button>
                                <button class="btn btn-outline-secondary" id="clearBtn">
                                    <i class="bi bi-x-circle"></i> Clear
                                </button>
                            </div>
                        </div>
                        
                        <div id="loadingSpinner" class="text-center mt-4" style="display: none;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2 text-muted">Analyzing image...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div class="col-lg-7">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title mb-4">
                            <i class="bi bi-clipboard-check"></i> Detection Results
                        </h5>
                        
                        <div id="noResults" class="text-center text-muted py-5">
                            <i class="bi bi-info-circle display-1"></i>
                            <p class="mt-3">No results yet. Upload an image to get started!</p>
                        </div>
                        
                        <div id="errorMessage" class="alert alert-danger" style="display: none;" role="alert">
                            <i class="bi bi-exclamation-triangle"></i>
                            <strong>Error:</strong> <span id="errorText"></span>
                        </div>
                        
                        <div id="resultsContainer" style="display: none;">
                            <!-- Disease Name & Confidence -->
                            <div class="mb-4">
                                <h4 class="mb-3">
                                    <span class="badge bg-primary result-badge" id="diseaseName">-</span>
                                </h4>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span><strong>Confidence:</strong></span>
                                    <span class="fs-4" id="confidence">-</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span><strong>Plant:</strong></span>
                                    <span id="plant">-</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span><strong>Pathogen:</strong></span>
                                    <span id="pathogen">-</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span><strong>Severity:</strong></span>
                                    <span class="badge bg-warning" id="severity">-</span>
                                </div>
                            </div>

                            <!-- Tabs for detailed info -->
                            <ul class="nav nav-tabs" id="resultTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="symptoms-tab" data-bs-toggle="tab" data-bs-target="#symptoms" type="button">
                                        Symptoms
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="treatment-tab" data-bs-toggle="tab" data-bs-target="#treatment" type="button">
                                        Treatment
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="prevention-tab" data-bs-toggle="tab" data-bs-target="#prevention" type="button">
                                        Prevention
                                    </button>
                                </li>
                            </ul>
                            
                            <div class="tab-content mt-3" id="resultTabsContent">
                                <!-- Symptoms Tab -->
                                <div class="tab-pane fade show active" id="symptoms" role="tabpanel">
                                    <div id="symptomsList"></div>
                                </div>
                                
                                <!-- Treatment Tab -->
                                <div class="tab-pane fade" id="treatment" role="tabpanel">
                                    <div id="treatmentContent"></div>
                                </div>
                                
                                <!-- Prevention Tab -->
                                <div class="tab-pane fade" id="prevention" role="tabpanel">
                                    <div id="preventionList"></div>
                                    <div class="mt-3">
                                        <strong>Prognosis:</strong>
                                        <p id="prognosis" class="mt-2"></p>
                                        <strong>Spread Risk:</strong>
                                        <p id="spreadRisk" class="mt-2"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // DOM elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const previewContainer = document.getElementById('previewContainer');
        const previewImage = document.getElementById('previewImage');
        const detectBtn = document.getElementById('detectBtn');
        const clearBtn = document.getElementById('clearBtn');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const noResults = document.getElementById('noResults');
        const resultsContainer = document.getElementById('resultsContainer');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');

        let selectedFile = null;

        // Upload area click
        uploadArea.addEventListener('click', () => fileInput.click());

        // File selection
        fileInput.addEventListener('change', handleFileSelect);

        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFileSelect();
            }
        });

        // Handle file selection
        function handleFileSelect() {
            const file = fileInput.files[0];
            if (!file) return;

            selectedFile = file;

            // Show preview
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                uploadArea.style.display = 'none';
                previewContainer.style.display = 'block';
                hideError();
                hideResults();
            };
            reader.readAsDataURL(file);
        }

        // Clear button
        clearBtn.addEventListener('click', () => {
            selectedFile = null;
            fileInput.value = '';
            uploadArea.style.display = 'block';
            previewContainer.style.display = 'none';
            hideResults();
            hideError();
        });

        // Detect button
        detectBtn.addEventListener('click', runDetection);

        // Run detection
        async function runDetection() {
            if (!selectedFile) return;

            // Show loading
            loadingSpinner.style.display = 'block';
            detectBtn.disabled = true;
            hideError();
            hideResults();

            // Create form data
            const formData = new FormData();
            formData.append('file', selectedFile);

            try {
                const response = await fetch('/detect', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    displayResults(data);
                } else {
                    showError(data.error || 'Detection failed');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            } finally {
                loadingSpinner.style.display = 'none';
                detectBtn.disabled = false;
            }
        }

        // Display results
        function displayResults(data) {
            noResults.style.display = 'none';
            resultsContainer.style.display = 'block';

            // Basic info
            document.getElementById('diseaseName').textContent = data.disease_name;
            
            const confidenceEl = document.getElementById('confidence');
            confidenceEl.textContent = data.confidence + '%';
            confidenceEl.className = data.confidence >= 80 ? 'fs-4 confidence-high' : 
                                    data.confidence >= 60 ? 'fs-4 confidence-medium' : 
                                    'fs-4 confidence-low';

            document.getElementById('plant').textContent = data.plant;
            document.getElementById('pathogen').textContent = 
                data.pathogen_type ? `${data.pathogen_type} - ${data.pathogen_name}` : 'N/A';
            document.getElementById('severity').textContent = data.severity;

            // Symptoms
            const symptomsList = document.getElementById('symptomsList');
            symptomsList.innerHTML = '';
            if (data.symptoms && data.symptoms.length > 0) {
                data.symptoms.forEach(symptom => {
                    const div = document.createElement('div');
                    div.className = 'symptom-item';
                    div.innerHTML = `<i class="bi bi-check-circle text-primary"></i> ${symptom}`;
                    symptomsList.appendChild(div);
                });
            } else {
                symptomsList.innerHTML = '<p class="text-muted">No symptom information available</p>';
            }

            // Treatment
            const treatmentContent = document.getElementById('treatmentContent');
            treatmentContent.innerHTML = '';
            if (data.treatment) {
                const sections = [
                    { key: 'immediate_actions', title: 'Immediate Actions', icon: 'exclamation-triangle' },
                    { key: 'chemical_control', title: 'Chemical Control', icon: 'flask' },
                    { key: 'organic_control', title: 'Organic Control', icon: 'leaf' },
                    { key: 'cultural_practices', title: 'Cultural Practices', icon: 'tree' }
                ];

                sections.forEach(section => {
                    if (data.treatment[section.key] && data.treatment[section.key].length > 0) {
                        const div = document.createElement('div');
                        div.className = 'treatment-section';
                        div.innerHTML = `
                            <h6><i class="bi bi-${section.icon}"></i> ${section.title}</h6>
                            <ul class="mb-0">
                                ${data.treatment[section.key].map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        `;
                        treatmentContent.appendChild(div);
                    }
                });
            }

            // Prevention
            const preventionList = document.getElementById('preventionList');
            preventionList.innerHTML = '';
            if (data.prevention && data.prevention.length > 0) {
                data.prevention.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'prevention-item';
                    div.innerHTML = `<i class="bi bi-shield-check text-info"></i> ${item}`;
                    preventionList.appendChild(div);
                });
            }

            document.getElementById('prognosis').textContent = data.prognosis || 'N/A';
            document.getElementById('spreadRisk').textContent = data.spread_risk || 'N/A';
        }

        // Show error
        function showError(message) {
            errorText.textContent = message;
            errorMessage.style.display = 'block';
            hideResults();
        }

        // Hide error
        function hideError() {
            errorMessage.style.display = 'none';
        }

        // Hide results
        function hideResults() {
            resultsContainer.style.display = 'none';
            noResults.style.display = 'block';
        }
    </script>
</body>
</html>
